language: cpp

jobs:
  include:
  - os: linux
    compiler: gcc  
    before_install:
    - source /opt/qt512/bin/qt512-env.sh
    - cargo install librespot
    script:
    - mkdir build
    - cd build
    - cmake .. -G "Unix Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=AppDir/usr || travis_terminate 1;
    - make -j$(nproc) || travis_terminate 1;
    - make test || travis_terminate 1;
    - make install || travis_terminate 1;
    - make clean || travis_terminate 1;
    - "../deploy/travis/build-appimage.sh"
    - "../deploy/travis/deploy-appimage.sh"
  - os: osx
    before_install:
    - brew link qt --force
    script:
    - cmake .. -G "Unix Makefiles" -DCMAKE_BUILD_TYPE=Release || travis_terminate 1;
    - make -j$(sysctl -n hw.physicalcpu)
    - make test

before_script:
- cmake -version

addons:
  apt:
    update: true
    sources:
    - sourceline: 'ppa:beineri/opt-qt-5.12.8-xenial'
    packages:
    - appstream/xenial-backports
    - cargo
    - binutils
    - curl
    - openssl
    - qt512base
    - qt512declarative
    - qt512graphicaleffects
    - qt512imageformats
    - qt512multimedia
    - qt512quickcontrols
    - qt512quickcontrols2
    - qt512script
    - qt512tools
    - qt512translations
    - mesa-utils
    - libegl1-mesa-dev
    - libgl1-mesa-dev
    - libglu1-mesa-dev
    - libpoppler-qt5-dev
    - libpulse-dev
    - libasound2-dev
    - gstreamer1.0-tools
    - gstreamer1.0-plugins-base
    - gstreamer1.0-plugins-good
    - gstreamer1.0-plugins-bad
    - gstreamer1.0-plugins-ugly
    - libtag1-dev
    - qt5keychain-dev
    - libtinyxml2-dev
  homebrew:
    update: true
    packages:
    - qt
    - taglib
    - poppler
    - qtkeychain
    - tinyxml2

notifications:
  email:
    recipients:
      - phil.hoffmann@zoho.eu
    on_success: never
    on_failure: always
