language: cpp
sudo: required
dist: trusty

addons:
  coverity_scan:
    project:
      name: "PhilInTheGaps/GM-Companion"
      description: "A gamemaster tool."
    notification_email: phil.hoffmann@zoho.eu
    build_command_prepend: qmake
    build_command: make
    branch_pattern: coverity_scan

matrix:
  include:
    - os: linux
	  addons:
		apt:
		  sources:
			- ubuntu-toolchain-r-test
		  packages:
			- g++-7
	  env:
		- MATRIX_EVAL="CC=gcc-7 && CXX=g++-7"
      compiler: gcc
      before_install:
      	- eval "${MATRIX_EVAL}"
        - sudo add-apt-repository --yes ppa:beineri/opt-qt-5.10.1-trusty
        - sudo apt-get update -qq
        - sudo apt-get -y install binutils libpulse-dev qt510base qt510declarative qt510multimedia qt510networkauth-no-lgpl qt510quickcontrols qt510quickcontrols2 qt510script qt510tools qt510translations qt510webengine
        - source /opt/qt510/bin/qt510-env.sh

      script:
        - qmake
        - make
        
    - os: osx
	  osx_image: xcode8
      env:
        - MATRIX_EVAL="brew install gcc && CC=gcc-7 && CXX=g++-7"
      before_install:
      	- eval "${MATRIX_EVAL}"
        - brew update
        - brew install qt5
        - brew link qt5 --force
      script:
        - qmake
        - make

before_script:
  - qmake -version

notifications:
    slack: gm-companion:hYQtgVm2LokcpUT6SbnELwSN
